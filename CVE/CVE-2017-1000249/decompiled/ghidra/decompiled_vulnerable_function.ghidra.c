size_t donote(magic_set *ms,void *vbuf,size_t offset,size_t size,int clazz,int swap,size_t align,
             int *flags,uint16_t *notecount,int fd,off_t ph_off,int ph_num,off_t fsize)

{
  ulong noff_00;
  byte *pbVar1;
  Elf64_Word EVar2;
  long lVar3;
  undefined8 uVar4;
  uint32_t value;
  int iVar5;
  uint value_00;
  int iVar6;
  Elf64_Nhdr *pEVar7;
  size_t doff;
  ulong uVar8;
  char *fmt;
  undefined1 *puVar9;
  long lVar10;
  ulong uVar11;
  long in_FS_OFFSET;
  bool bVar12;
  ulong local_a0;
  size_t noff;
  uint32_t local_90;
  Elf32_Nhdr nh32;
  Elf64_Nhdr nh64;
  uint8_t desc [20];
  
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  local_a0 = 0;
  if (*notecount == 0) goto LAB_00105100;
  *notecount = *notecount - 1;
  noff_00 = offset + 0xc;
  local_a0 = noff_00;
  if (size < noff_00) goto LAB_00105100;
  pEVar7 = &nh64;
  if (clazz == 1) {
    pEVar7 = (Elf64_Nhdr *)&nh32;
  }
  EVar2 = *(Elf64_Word *)((undefined8 *)(offset + (long)vbuf) + 1);
  *(undefined8 *)pEVar7 = *(undefined8 *)(offset + (long)vbuf);
  pEVar7->n_type = EVar2;
  if (clazz == 1) {
    local_90 = nh32.n_namesz;
    nh64.n_descsz = nh32.n_descsz;
    if (swap != 0) {
      local_90 = getu32(nh32.n_namesz);
LAB_001045cd:
      nh64.n_descsz = getu32(nh32.n_descsz);
    }
  }
  else {
    local_90 = nh64.n_namesz;
    if (swap != 0) {
      local_90 = getu32(nh64.n_namesz);
      nh32.n_descsz = nh64.n_descsz;
      goto LAB_001045cd;
    }
  }
  local_a0 = size;
  if ((local_90 | nh64.n_descsz) == 0) goto LAB_00105100;
  if ((int)local_90 < 0) {
    file_printf(ms,", bad note name size 0x%lx",(ulong)local_90);
    local_a0 = 0;
    goto LAB_00105100;
  }
  if ((int)nh64.n_descsz < 0) {
    file_printf(ms,", bad note description size 0x%lx",(ulong)nh64.n_descsz);
    local_a0 = 0;
    goto LAB_00105100;
  }
  doff = ((local_90 + noff_00 + (align - 1)) / align) * align;
  local_a0 = doff;
  if (size < local_90 + noff_00) goto LAB_00105100;
  uVar8 = ((doff + nh64.n_descsz + (align - 1)) / align) * align;
  local_a0 = uVar8;
  if (size < doff + nh64.n_descsz) {
    local_a0 = size;
    if (size <= uVar8) {
      local_a0 = uVar8;
    }
    goto LAB_00105100;
  }
  value_00 = *flags;
  if ((value_00 & 2) == 0) {
    value = nh64.n_type;
    if (clazz == 1) {
      value = nh32.n_type;
    }
    if (swap != 0) {
      value = getu32(value);
    }
    if (local_90 == 5) {
      iVar5 = strcmp((char *)((long)vbuf + noff_00),"SuSE");
      if (((iVar5 == 0) && (value == 1)) && (nh64.n_descsz == 2)) {
        *flags = value_00 | 2;
        file_printf(ms,", for SuSE %d.%d",(ulong)*(byte *)((long)vbuf + doff),
                    (ulong)*(byte *)((long)vbuf + doff + 1));
        goto LAB_00105100;
      }
    }
    else {
      if (local_90 == 4) {
        iVar5 = strcmp((char *)((long)vbuf + noff_00),"GNU");
        if (((iVar5 == 0) && (value == 1)) && (nh64.n_descsz == 0x10)) {
          uVar4 = *(undefined8 *)((long)vbuf + doff);
          noff_00 = *(ulong *)((long)vbuf + doff + 8);
          *flags = value_00 | 2;
          iVar5 = file_printf(ms,", for GNU/");
          if (iVar5 != -1) {
            value = (uint32_t)uVar4;
            if (swap != 0) {
              value = getu32(value);
            }
            fmt = "<unknown>";
            switch(value) {
            case 0:
              fmt = "Linux";
              break;
            case 1:
              fmt = "Hurd";
              break;
            case 2:
              fmt = "Solaris";
              break;
            case 3:
              fmt = "kFreeBSD";
              break;
            case 4:
              fmt = "kNetBSD";
            }
            iVar5 = file_printf(ms,fmt);
            if (iVar5 != -1) {
              uVar8 = noff_00 >> 0x20;
              if (swap != 0) {
                value = getu32((uint32_t)(noff_00 >> 0x20));
                uVar8 = (ulong)value;
              }
              uVar11 = noff_00 & 0xffffffff;
              if (swap != 0) {
                value = getu32((uint32_t)noff_00);
                uVar11 = (ulong)value;
              }
              value_00 = (uint)((ulong)uVar4 >> 0x20);
              if (swap != 0) {
                value_00 = getu32(value_00);
              }
              file_printf(ms," %d.%d.%d",(ulong)value_00,uVar11,uVar8);
            }
          }
          goto LAB_00105100;
        }
      }
      else {
        if (local_90 == 7) {
          iVar5 = strcmp((char *)((long)vbuf + noff_00),"NetBSD");
          if (((iVar5 == 0) && (value == 1)) && (nh64.n_descsz == 4)) {
            *flags = value_00 | 2;
            value = *(uint32_t *)((long)vbuf + doff);
            if (swap != 0) {
              value = getu32(value);
            }
            iVar5 = file_printf(ms,", for NetBSD");
            if (((iVar5 != -1) && (100000000 < value)) &&
               (iVar5 = file_printf(ms," %u.%u",(ulong)(value / 100000000)), iVar5 != -1)) {
              noff_00 = ((ulong)value / 100) % 100;
              uVar8 = ((ulong)value / 10000) % 100;
              if (((int)uVar8 == 0) && ((int)noff_00 != 0)) {
                file_printf(ms,".%u",noff_00);
              }
              else {
                if ((int)uVar8 != 0) {
                  while (value_00 = (uint)uVar8, 0x1a < value_00) {
                    iVar5 = file_printf(ms,"Z");
                    if (iVar5 == -1) goto LAB_00105100;
                    uVar8 = (ulong)(value_00 - 0x1a);
                  }
                  file_printf(ms,"%c",(ulong)(value_00 + 0x40));
                }
              }
            }
            goto LAB_00105100;
          }
        }
        else {
          if (local_90 == 8) {
            iVar5 = strcmp((char *)((long)vbuf + noff_00),"FreeBSD");
            if (((iVar5 == 0) && (value == 1)) && (nh64.n_descsz == 4)) {
              *flags = value_00 | 2;
              value = *(uint32_t *)((long)vbuf + doff);
              if (swap != 0) {
                value = getu32(value);
              }
              iVar5 = file_printf(ms,", for FreeBSD");
              if (iVar5 == -1) goto LAB_00105100;
              if (value == 0x704e2) {
                file_printf(ms," 4.6.2");
                goto LAB_00105100;
              }
              if (value < 0x70544) {
                iVar5 = file_printf(ms," %d.%d",(ulong)(value / 100000),((ulong)value / 10000) % 10)
                ;
                if (((iVar5 == -1) ||
                    (((int)(((ulong)value / 1000) % 10) != 0 &&
                     (iVar5 = file_printf(ms,".%d"), iVar5 == -1)))) ||
                   ((value % 1000 == 0 && (value % 100000 != 0)))) goto LAB_00105100;
              }
              else {
                if (value < 500000) {
                  iVar5 = file_printf(ms," %d.%d",4,
                                      (ulong)((int)(((ulong)value / 10000) % 10) +
                                             (value / 1000) % 10));
                  if (iVar5 == -1) goto LAB_00105100;
                  if ((int)(((ulong)value / 100) % 10) == 0) {
                    iVar5 = (int)(((ulong)value / 10) % 10);
joined_r0x00104bfd:
                    if (iVar5 != 0) {
                      file_printf(ms,".%d");
                    }
                    goto LAB_00105100;
                  }
                }
                else {
                  iVar5 = file_printf(ms," %d.%d",(ulong)(value / 100000),
                                      (ulong)(value / 1000) % 100);
                  if (iVar5 == -1) goto LAB_00105100;
                  if (((int)(((ulong)value / 100) % 10) == 0) && (99 < value % 100000)) {
                    iVar5 = (int)(((ulong)value / 10) % 10);
                    goto joined_r0x00104bfd;
                  }
                }
              }
              file_printf(ms," (%d)",(ulong)value);
              goto LAB_00105100;
            }
            iVar5 = strcmp((char *)((long)vbuf + noff_00),"OpenBSD");
            if (((iVar5 == 0) && (value == 1)) && (nh64.n_descsz == 4)) {
              *flags = value_00 | 2;
              file_printf(ms,", for OpenBSD");
              goto LAB_00105100;
            }
          }
          else {
            if ((((local_90 == 10) &&
                 (iVar5 = strcmp((char *)((long)vbuf + noff_00),"DragonFly"), iVar5 == 0)) &&
                (value == 1)) && (nh64.n_descsz == 4)) {
              *flags = value_00 | 2;
              iVar5 = file_printf(ms,", for DragonFly");
              if (iVar5 != -1) {
                value = *(uint32_t *)((long)vbuf + doff);
                if (swap != 0) {
                  value = getu32(value);
                }
                file_printf(ms," %d.%d.%d",(ulong)(value / 100000),((ulong)value / 10000) % 10,
                            (ulong)value % 10000);
              }
              goto LAB_00105100;
            }
          }
        }
      }
    }
  }
  if ((value_00 & 4) == 0) {
    value = nh64.n_type;
    if (clazz == 1) {
      value = nh32.n_type;
    }
    if (swap != 0) {
      value = getu32(value);
    }
    if (((local_90 == 4) && (iVar5 = strcmp((char *)((long)vbuf + noff_00),"GNU"), iVar5 == 0)) &&
       (value == 3)) {
      fmt = "md5/uuid";
      *flags = value_00 | 4;
      if (((nh64.n_descsz != 0x10) && (fmt = "sha1", nh64.n_descsz != 0x14)) &&
         (fmt = "xxHash", nh64.n_descsz != 8)) {
        fmt = "unknown";
      }
      iVar5 = file_printf(ms,", BuildID[%s]=",fmt);
      if (iVar5 != -1) {
        lVar10 = 0;
        __memcpy_chk(desc,(void *)(doff + (long)vbuf),(ulong)nh64.n_descsz,0x14);
        do {
          if (nh64.n_descsz <= (uint)lVar10) break;
          pbVar1 = desc + lVar10;
          lVar10 = lVar10 + 1;
          iVar5 = file_printf(ms,"%02x",(ulong)*pbVar1);
        } while (iVar5 != -1);
      }
      goto LAB_00105100;
    }
  }
  if ((value_00 & 0x10) == 0) {
    value = nh64.n_type;
    if (clazz == 1) {
      value = nh32.n_type;
    }
    if (swap != 0) {
      value = getu32(value);
    }
    if (((local_90 == 4) && (iVar5 = strcmp((char *)((long)vbuf + noff_00),"PaX"), iVar5 == 0)) &&
       ((value == 3 && (nh64.n_descsz == 4)))) {
      *flags = value_00 | 0x10;
      value = *(uint32_t *)((long)vbuf + doff);
      if (swap != 0) {
        value = getu32(value);
      }
      if ((value == 0) || (iVar6 = file_printf(ms,", PaX: "), iVar6 != -1)) {
        lVar10 = 0;
        do {
          if ((1 << ((byte)lVar10 & 0x1f) & value) != 0) {
            bVar12 = iVar5 == 0;
            iVar5 = iVar5 + 1;
            puVar9 = &DAT_0011b6eb;
            if (bVar12) {
              puVar9 = &DAT_0011ad97;
            }
            iVar6 = file_printf(ms,"%s%s",puVar9);
            if (iVar6 == -1) break;
          }
          lVar10 = lVar10 + 1;
        } while (lVar10 != 6);
      }
      goto LAB_00105100;
    }
  }
  if ((value_00 & 1) == 0) {
    value = nh64.n_type;
    if (clazz == 1) {
      value = nh32.n_type;
    }
    if (swap != 0) {
      value = getu32(value);
    }
    iVar5 = do_core_note(ms,(uchar *)vbuf,value,swap,local_90,nh64.n_descsz,noff_00,doff,flags,size,
                         clazz);
    if (iVar5 != 0) goto LAB_00105100;
  }
  if (((uint)*flags >> 9 & 1) == 0) {
    value = nh64.n_type;
    if (clazz == 1) {
      value = nh32.n_type;
    }
    if (swap != 0) {
      value = getu32(value);
    }
    iVar5 = do_auxv_note(ms,(uchar *)vbuf,value,swap,nh64.n_descsz,doff,flags,clazz,fd,ph_off,ph_num
                         ,fsize);
    if (iVar5 != 0) goto LAB_00105100;
  }
  if ((local_90 == 7) && (iVar5 = strcmp((char *)(noff_00 + (long)vbuf),"NetBSD"), iVar5 == 0)) {
    if (100 < nh64.n_descsz) {
      nh64.n_descsz = 100;
    }
    if (clazz == 1) {
      nh64.n_type = nh32.n_type;
    }
    if (swap != 0) {
      nh64.n_type = getu32(nh64.n_type);
    }
    if (nh64.n_type == 5) {
      if ((*flags & 0x20U) == 0) {
        *flags = *flags | 0x20;
        file_printf(ms,", compiled for: %.*s",(ulong)nh64.n_descsz,(void *)(doff + (long)vbuf));
      }
    }
    else {
      if (nh64.n_type == 6) {
        if ((*flags & 0x40U) == 0) {
          *flags = *flags | 0x40;
          file_printf(ms,", compiler model: %.*s",(ulong)nh64.n_descsz,(void *)(doff + (long)vbuf));
        }
      }
      else {
        if ((nh64.n_type != 1) && ((*flags & 0x80U) == 0)) {
          *flags = *flags | 0x80;
          file_printf(ms,", note=%u",(ulong)nh64.n_type);
        }
      }
    }
  }
LAB_00105100:
  if (lVar3 != *(long *)(in_FS_OFFSET + 0x28)) {
                    /* WARNING: Subroutine does not return */
    __stack_chk_fail();
  }
  return local_a0;
}

void main() {
	donote(ms,  *vbuf, offset, size, clazz, swap, align, flags, notecount, fd, ph_off, ph_num, fsize);
	return;
}
