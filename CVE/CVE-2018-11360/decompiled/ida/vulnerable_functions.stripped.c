#include <emmintrin.h>
#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <errno.h>
#include <math.h>
#include <defs.h>
#include <stdarg.h>

// Wireshark imports

#include "config.h"

#include <epan/packet.h>
#include <epan/expert.h>
#include <epan/tap.h>
//#include <epan/strutil.h>

#include "packet-bssap.h"
#include "packet-ber.h"
#include "packet-q931.h"
#include "packet-gsm_a_common.h"
#include "packet-ppp.h"
#include "packet-isup.h"


void __fastcall IA5_7BIT_decode(_BYTE *a1, unsigned __int8 *a2, int a3)
{
  _BYTE *v3; // rbp
  unsigned __int8 *v4; // rbx
  int v5; // er14
  unsigned __int8 *v6; // r12
  __int64 v7; // rax
  signed __int64 v8; // rdi

  v3 = a1;
  if ( a3 > 0 )
  {
    v4 = a2;
    v5 = 0;
    v6 = &a2[a3 - 1 + 1];
    do
    {
      v7 = *v4;
      v8 = 63LL;
      if ( (v7 & 0x80u) == 0LL )
        v8 = dword_26CFC40[v7];
      ++v4;
      v5 += g_unichar_to_utf8(v8, &v3[v5]);
    }
    while ( v4 != v6 );
    v3 += v5;
  }
  *v3 = 0;
}


signed __int64 __fastcall de_sub_addr(__int64 a1, __int64 a2, __int64 a3, __int64 a4, unsigned int a5, _QWORD *a6)
{
  __int64 v6; // r15
  __int64 v7; // r12
  __int64 v8; // rbp
  unsigned int v9; // er13
  _QWORD *v10; // r14
  unsigned int v11; // ebx
  char v12; // al
  unsigned int v13; // er10
  signed __int64 result; // rax
  __int64 v15; // rdi
  __int64 v16; // rax
  signed int v17; // ebx
  unsigned __int8 *v18; // rsi
  int v19; // eax
  __int64 v20; // rax
  unsigned __int8 *v21; // [rsp+0h] [rbp-48h]
  char v22; // [rsp+8h] [rbp-40h]
  unsigned int v23; // [rsp+8h] [rbp-40h]

  v6 = a3;
  v7 = a2;
  v8 = a1;
  v9 = a5;
  *a6 = 0LL;
  v10 = a6;
  v11 = a4;
  proto_tree_add_item(a2, unk_4336798, a1, a4, 1LL);
  proto_tree_add_item(a2, (unsigned int)dword_433B224, a1, v11, 1LL);
  proto_tree_add_item(a2, (unsigned int)dword_433B220, a1, v11, 1LL);
  proto_tree_add_bits_item(a2, (unsigned int)dword_4336788, a1, 8 * v11 + 5, 3LL, 0LL);
  v12 = tvb_get_guint8(a1);
  if ( v9 <= 1 )
    return v9;
  v13 = v11 + 1;
  if ( v12 & 0x70 )
  {
LABEL_3:
    proto_tree_add_item(a2, (unsigned int)dword_433AF1C, a1, v13, v11 + v9 - v13);
    return v9;
  }
  v22 = tvb_get_guint8(a1);
  proto_tree_add_item(a2, (unsigned int)dword_433B154, a1, v11 + 1, 1LL);
  result = 2LL;
  if ( v9 != 2 )
  {
    v13 = v11 + 2;
    if ( v22 == 80 )
    {
      v15 = wmem_packet_scope(a2);
      v23 = v11 + 2;
      v21 = (unsigned __int8 *)tvb_memdup(v15, v8);
      v16 = wmem_packet_scope(v15);
      v17 = 0;
      *v10 = wmem_alloc(v16, v9 - 2);
      v18 = v21;
      do
      {
        v19 = (*v18 & 0xF) + 10 * (*v18 >> 4) + 32;
        *v18 = (*v18 & 0xF) + 10 * (*v18 >> 4) + 32;
        if ( (v19 & 0x80u) != 0 )
          v17 = 1;
        ++v18;
      }
      while ( &v21[v9 - 2] != v18 );
      IA5_7BIT_decode((_BYTE *)*v10, v21, v9 - 2);
      v20 = proto_tree_add_string(v7, (unsigned int)dword_433AF20, v8, v23, v9 - 2);
      if ( v17 )
        expert_add_info(v6, v20);
      return v9;
    }
    goto LABEL_3;
  }
  return result;
}
