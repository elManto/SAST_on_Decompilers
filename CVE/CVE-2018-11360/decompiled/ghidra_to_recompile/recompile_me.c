#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <errno.h>
#include <math.h>
//#include <defs.h>
#include <stdarg.h>
#include <stdbool.h>

// Wireshark imports

#include "config.h"

#include <epan/packet.h>
#include <epan/expert.h>
#include <epan/tap.h>
//#include <epan/strutil.h>

#include "packet-bssap.h"
#include "packet-ber.h"
#include "packet-q931.h"
#include "packet-gsm_a_common.h"
#include "packet-ppp.h"
#include "packet-isup.h"

typedef unsigned char   undefined;
typedef unsigned char    byte;
typedef unsigned char    dwfenc;
typedef unsigned int    dword;
typedef unsigned long    qword;
typedef unsigned int    uint;
typedef unsigned long    ulong;
typedef unsigned char    undefined1;
typedef unsigned short    undefined2;
typedef unsigned int    undefined4;
typedef unsigned long    undefined8;
typedef unsigned short    ushort;
typedef unsigned short    word;


long DAT_027cfc40;
long DAT_04436798;
long DAT_0443b224;
long DAT_0443b220;
long DAT_04436788;
long DAT_0443b154;
long DAT_0443af20;
long DAT_0443ae08;
long DAT_0443af1c;



char * epan_strcasestr(char *param_1,char *param_2)

{
  int iVar1;
  ulong uVar2;
  size_t sVar3;

  uVar2 = strlen(param_1);
  sVar3 = strlen(param_2);
  while( true ) {
    if (uVar2 < sVar3) {
      return (char *)0x0;
    }
    iVar1 = g_ascii_strncasecmp(param_1,param_2,sVar3);
    if (iVar1 == 0) break;
    uVar2 = uVar2 - 1;
    param_1 = param_1 + 1;
  }
  return param_1;
}


char * string_or_null(char *param_1)

{
  if (param_1 == (char *)0x0) {
    param_1 = "[NULL]";
  }
  return param_1;
}



int escape_string_len(byte *param_1)

{
  int iVar1;
  int iVar2;
  ulong uVar3;

  uVar3 = (ulong)*param_1;
  if (*param_1 == 0) {
    return 2;
  }
  iVar1 = 0;
  do {
    while (((char)uVar3 == '\\' || ((char)uVar3 == '\"'))) {
      param_1 = param_1 + 1;
      uVar3 = (ulong)*param_1;
      iVar1 = iVar1 + 2;
      if (*param_1 == 0) goto LAB_01aeaf78;
    }
    iVar2 = iVar1 + 4;
    iVar1 = iVar1 + 1;
    if ((*(byte *)(g_ascii_table + uVar3 * 2) & 0x40) == 0) {
      iVar1 = iVar2;
    }
    param_1 = param_1 + 1;
    uVar3 = (ulong)*param_1;
  } while (*param_1 != 0);
LAB_01aeaf78:
  return iVar1 + 2;
}




undefined * escape_string(undefined *param_1,byte *param_2)

{
  long lVar1;
  char cVar2;
  ulong uVar3;
  undefined2 *puVar4;
  undefined2 *puVar5;
  long in_FS_OFFSET;
  undefined local_33;
  undefined local_32;
  long local_30;

  puVar4 = (undefined2 *)(param_1 + 1);
  *param_1 = 0x22;
  uVar3 = (ulong)*param_2;
  local_30 = *(long *)(in_FS_OFFSET + 0x28);
  if (*param_2 != 0) {
    puVar5 = puVar4;
    do {
      while ((cVar2 = (char)uVar3, cVar2 == '\\' || (cVar2 == '\"'))) {
        param_2 = param_2 + 1;
        *(undefined *)puVar5 = 0x5c;
        *(char *)((long)puVar5 + 1) = cVar2;
        uVar3 = (ulong)*param_2;
        puVar4 = puVar5 + 1;
        puVar5 = puVar4;
        if (*param_2 == 0) goto LAB_01aeb00d;
      }
      if ((*(byte *)(g_ascii_table + uVar3 * 2) & 0x40) == 0) {
        puVar4 = puVar5 + 2;
        g_snprintf(&local_33,3,"%02x");
        *puVar5 = 0x785c;
        *(undefined *)(puVar5 + 1) = local_33;
        *(undefined *)((long)puVar5 + 3) = local_32;
      }
      else {
        *(char *)puVar5 = cVar2;
        puVar4 = (undefined2 *)((long)puVar5 + 1);
      }
      param_2 = param_2 + 1;
      uVar3 = (ulong)*param_2;
      puVar5 = puVar4;
    } while (*param_2 != 0);
  }
LAB_01aeb00d:
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  *puVar4 = 0x22;
  if (local_30 == lVar1) {
    return param_1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}




void IA5_7BIT_decode(undefined *param_1,byte *param_2,int param_3)

{
  byte *pbVar1;
  int iVar2;
  undefined4 uVar3;
  int iVar4;

  if (0 < param_3) {
    iVar4 = 0;
    pbVar1 = param_2 + (ulong)(param_3 - 1) + 1;
    do {
      uVar3 = 0x3f;
      if (-1 < (char)*param_2) {
        uVar3 = *(undefined4 *)(&DAT_027cfc40 + (ulong)*param_2 * 4);
      }
      param_2 = param_2 + 1;
      iVar2 = g_unichar_to_utf8(uVar3,param_1 + iVar4);
      iVar4 = iVar4 + iVar2;
    } while (param_2 != pbVar1);
    param_1 = param_1 + iVar4;
  }
  *param_1 = 0;
  return;
}


char * ws_strdup_escape_char(char *param_1,char param_2)

{
  size_t sVar1;
  char *pcVar2;
  char *pcVar3;
  char cVar4;
  char *pcVar5;

  if (param_1 == (char *)0x0) {
    return (char *)0x0;
  }
  sVar1 = strlen(param_1);
  pcVar2 = (char *)g_malloc(sVar1 * 2 + 1);
  cVar4 = *param_1;
  pcVar3 = pcVar2;
  if (cVar4 == '\0') {
    *pcVar2 = '\0';
    return pcVar2;
  }
  do {
    pcVar5 = pcVar3 + 1;
    if (param_2 == cVar4) {
      pcVar5 = pcVar3 + 2;
      *pcVar3 = param_2;
      pcVar3 = pcVar3 + 1;
    }
    param_1 = param_1 + 1;
    *pcVar3 = cVar4;
    cVar4 = *param_1;
    pcVar3 = pcVar5;
  } while (cVar4 != '\0');
  *pcVar5 = '\0';
  return pcVar2;
}


char * ws_strdup_unescape_char(char *param_1,char param_2)

{
  char *pcVar1;
  char *pcVar2;
  char cVar4;
  bool bVar5;
  char *pcVar3;
  size_t local_20;

  if (param_1 == (char *)0x0) {
    return (char *)0x0;
  }
  local_20 = strlen(param_1);
  pcVar1 = (char *)g_malloc(local_20);
  cVar4 = *param_1;
  pcVar2 = pcVar1;
  while (pcVar3 = pcVar2, cVar4 != '\0') {
    while( true ) {
      pcVar2 = pcVar3 + 1;
      bVar5 = param_2 == cVar4;
      *pcVar3 = cVar4;
      cVar4 = param_1[1];
      if ((bVar5) && (cVar4 == param_2)) break;
      param_1 = param_1 + 1;
      pcVar3 = pcVar2;
      if (cVar4 == '\0') goto LAB_01aeb1b2;
    }
    cVar4 = param_1[2];
    param_1 = param_1 + 2;
  }
LAB_01aeb1b2:
  *pcVar2 = '\0';
  return pcVar1;
}


undefined8 string_replace(long param_1,long param_2,undefined8 param_3)

{
  undefined8 uVar1;
  undefined8 uVar2;

  if ((param_1 != 0) && (param_2 != 0)) {
    uVar1 = g_strsplit(param_1,param_2,0);
    uVar2 = g_strjoinv(param_3,uVar1);
    g_strfreev(uVar1);
    return uVar2;
  }
  return 0;
}



uint FUN_01aeb230(long param_1)

{
  return (uint)*(undefined8 *)(param_1 + 8) ^ *(uint *)(param_1 + 0x10);
}



int FUN_01aeb240(int *param_1)

{
  return param_1[3] + param_1[2] + *param_1;
}



bool FUN_01aeb250(long *param_1,long *param_2)

{
  if (*param_1 != *param_2) {
    return false;
  }
  return param_1[1] == param_2[1];
}


uint FUN_01e31e80(undefined8 param_1,undefined8 param_2,undefined8 param_3,ulong param_4, uint param_5,undefined8 *param_6)
{
  byte bVar1;
  bool bVar2;
  char cVar3;
  ulong uVar4;
  undefined8 uVar5;
  byte *pbVar6;
  int iVar7;
  byte *pbVar8;
  int iVar9;

  *param_6 = 0;
  uVar4 = param_4 & 0xffffffff;
  proto_tree_add_item(param_2,DAT_04436798,param_1,param_4,1,0);
  proto_tree_add_item(param_2,DAT_0443b224,param_1,uVar4,1,0);
  proto_tree_add_item(param_2,DAT_0443b220,param_1,uVar4,1,0);
  iVar7 = (int)uVar4;
  proto_tree_add_bits_item(param_2,DAT_04436788,param_1,iVar7 * 8 + 5,3,0);
  uVar4 = tvb_get_guint8(param_1,uVar4);
  if (param_5 < 2) {
    return param_5;
  }
  iVar9 = iVar7 + 1;
  if ((uVar4 & 0x70) == 0) {
    cVar3 = tvb_get_guint8(param_1,iVar9);
    proto_tree_add_item(param_2,DAT_0443b154,param_1,iVar9,1,0);
    if (param_5 == 2) {
      return 2;
    }
    iVar9 = iVar7 + 2;
    if (cVar3 == 'P') {
      iVar7 = param_5 - 2;
      uVar5 = wmem_packet_scope();
      pbVar6 = (byte *)tvb_memdup(uVar5,param_1,iVar9,iVar7);
      uVar5 = wmem_packet_scope();
      bVar2 = false;
      uVar5 = wmem_alloc(uVar5,iVar7);
      *param_6 = uVar5;
      pbVar8 = pbVar6;
      do {
        bVar1 = (*pbVar8 & 0xf) + 0x20 + (*pbVar8 >> 4) * '\n';
        *pbVar8 = bVar1;
        if ((char)bVar1 < '\0') {
          bVar2 = true;
        }
        pbVar8 = pbVar8 + 1;
      } while (pbVar6 + (ulong)(param_5 - 3) + 1 != pbVar8);
      IA5_7BIT_decode(*param_6,pbVar6,iVar7);
      uVar5 = proto_tree_add_string(param_2,DAT_0443af20,param_1,iVar9,iVar7,*param_6);
      if (!bVar2) {
        return param_5;
      }
      expert_add_info(param_3,uVar5,&DAT_0443ae08);
      return param_5;
    }
  }
  proto_tree_add_item(param_2,DAT_0443af1c,param_1,iVar9,(iVar7 + param_5) - iVar9,0);
  return param_5;
}

